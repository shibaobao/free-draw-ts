!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefaultShapeStyle={lineWidth:2,fillStyle:"rgba(14, 113, 235, 0.8)",strokeStyle:"#0E71EB"},t.DefaultHandlePointStyle={lineWidth:2,fillStyle:"#FFFFFF",strokeStyle:"#0E71EB",size:8}});
!function(e){if("object"==typeof module&&"object"==typeof module.exports){var o=e(require,exports);void 0!==o&&(module.exports=o)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,o){"use strict";var u,t,d;Object.defineProperty(o,"__esModule",{value:!0}),(u=o.Mode||(o.Mode={})).View="View",u.Edit="Edit",(t=o.Mouse||(o.Mouse={})).Mousedown="mousedown",t.Mousemove="mousemove",t.Mouseup="mouseup",t.Keydown="keydown",(d=o.ShapeType||(o.ShapeType={})).Rect="Rect",d.Ellipse="Ellipse",d.Polygon="Polygon"});
var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};!function(t){if("object"==typeof module&&"object"==typeof module.exports){var e=t(require,exports);void 0!==e&&(module.exports=e)}else"function"==typeof define&&define.amd&&define(["require","exports","./enum","./shapes/rect","./shapes/polygon","./shapes/ellipse"],t)}(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("./enum"),n=__importDefault(t("./shapes/rect")),r=__importDefault(t("./shapes/polygon")),a=__importDefault(t("./shapes/ellipse")),o=(s.prototype.init=function(){this.canvasDOM.addEventListener(i.Mouse.Mousedown,this.distributeCanvasEvents.bind(this)),this.canvasDOM.addEventListener(i.Mouse.Mousemove,this.distributeCanvasEvents.bind(this)),this.canvasDOM.addEventListener(i.Mouse.Mouseup,this.distributeCanvasEvents.bind(this))},s.prototype.distributeCanvasEvents=function(t){var e=t.type;if(t.offsetX,t.offsetY,this.mode===i.Mode.View){if(e===i.Mouse.Keydown)return}else e===i.Mouse.Mousedown||e===i.Mouse.Mouseup&&(this.clickedShapeId=""),this.eventsCallBack},s.prototype.updateMode=function(t,e){this.mode=t,this.editingShapeId=e||""},s.prototype.refresh=function(){for(var t in this.clearCanvas(),Object.keys(this.shapeInCanvas));},s.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},s.prototype.rectOptionFactory=function(t){return t.startPoint&&0<t.startPoint.length&&t.width&&t.height?(t.startPoint=this.getCoordinateWithoutZoomAndOffset(t.startPoint),t.height=this.removeZoomForLength(t.height),t.width=this.removeZoomForLength(t.width)):t.points&&4===t.points.length&&(t.startPoint=this.getCoordinateWithoutZoomAndOffset(t.points[0]),t.width=this.removeZoomForLength(t.points[1][0]-t.points[0][0]),t.height=this.removeZoomForLength(t.points[3][1]-t.points[0][1])),t},s.prototype.polygonOptionFactory=function(t){return t},s.prototype.ellipseOptionFactory=function(t){return t},s.prototype.getCoordinateWithoutZoomAndOffset=function(t){},s.prototype.getCoordinateWithZoomAndOffset=function(t){},s.prototype.removeZoomForLength=function(t){return Number((t/this.zoomLevel).toFixed(this.calculationAccuracy))},s.prototype.addZoomForLength=function(t){return Number((t*this.zoomLevel).toFixed(this.calculationAccuracy))},s.prototype.remove=function(t){this.shapeInCanvas[t]&&(delete this.shapeInCanvas[t],this.refresh())},s.prototype.removeAll=function(){this.shapeInCanvas={},this.refresh()},s.prototype.create=function(t){var e=t.id,o=t.type,s=null;if(this.mode===i.Mode.Edit)throw new Error("Can only edit one shape at a time");if(this.shapeInCanvas[e])throw new Error("Id must be unique, shape id '"+e+"' has already exist");if(this.updateMode(i.Mode.Edit,e),t.freeDraw=this,o===i.ShapeType.Rect)s=new n.default(this.rectOptionFactory(t));else if(o===i.ShapeType.Ellipse)s=new r.default(this.polygonOptionFactory(t));else{if(o!==i.ShapeType.Polygon)throw new Error("Shape type "+o+" is not support");s=new a.default(this.ellipseOptionFactory(t))}return this.shapeInCanvas[e]=s,this.shapeInCanvas[e]},s.prototype.setZoomAndOffset=function(t){t.zoomLevel&&(this.zoomLevel=t.zoomLevel),t.offsetLeft&&(this.offsetLeft=t.offsetLeft),t.offsetTop&&(this.offsetTop=t.offsetTop),t.transformCenter&&(this.transformCenter=t.transformCenter),this.refresh()},s.prototype.updateCtxStyle=function(t){t.lineWidth&&(this.ctx.lineWidth=t.lineWidth),t.fillStyle&&(this.ctx.fillStyle=t.fillStyle),t.strokeStyle&&(this.ctx.strokeStyle=t.strokeStyle)},s);function s(t){this.mode=i.Mode.View,this.editingShapeId="",this.clickedShapeId="",this.eventsReceive=[],this.shapeInCanvas={},this.zoomLevel=1,this.offsetTop=0,this.offsetLeft=0,this.transformCenter=[0,0],this.calculationAccuracy=2,this.canvasDOM=t.canvasDOM,this.ctx=this.canvasDOM.getContext("2d"),t.eventsReceive&&0<t.eventsReceive.length&&(this.eventsReceive=t.eventsReceive),t.eventsCallBack&&(this.eventsCallBack=t.eventsCallBack),t.zoomLevel&&(this.zoomLevel=t.zoomLevel),t.offsetTop&&(this.offsetTop=t.offsetTop),t.offsetLeft&&(this.offsetLeft=t.offsetLeft),t.transformCenter&&(this.transformCenter=t.transformCenter),t.calculationAccuracy&&(this.calculationAccuracy=t.calculationAccuracy),this.init()}e.default=o});
!function(e){if("object"==typeof module&&"object"==typeof module.exports){var o=e(require,exports);void 0!==o&&(module.exports=o)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0})});
var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};!function(t){if("object"==typeof module&&"object"==typeof module.exports){var e=t(require,exports);void 0!==e&&(module.exports=e)}else"function"==typeof define&&define.amd&&define(["require","exports","./shape"],t)}(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=__importDefault(t("./shape")),n=(o=r.default,__extends(i,o),i);function i(t){return o.call(this,t)||this}e.default=n});
var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};!function(t){if("object"==typeof module&&"object"==typeof module.exports){var e=t(require,exports);void 0!==e&&(module.exports=e)}else"function"==typeof define&&define.amd&&define(["require","exports","./shape"],t)}(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=__importDefault(t("./shape")),n=(o=r.default,__extends(i,o),i);function i(t){return o.call(this,t)||this}e.default=n});
var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};!function(t){if("object"==typeof module&&"object"==typeof module.exports){var e=t(require,exports);void 0!==e&&(module.exports=e)}else"function"==typeof define&&define.amd&&define(["require","exports","./shape"],t)}(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,o=__importDefault(t("./shape")),n=(i=o.default,__extends(r,i),r.prototype.draw=function(){this.shape=this.drawRect(),this.generateHandlePoints(),this.edit&&this.drawRectHandlePoints()},r.prototype.drawRect=function(){var t=this.getRectAttributes(),e=t.width,i=t.height,o=t.startPoint,n=new Path2D;return n.rect(o[0],o[1],e,i),this.freeDraw.updateCtxStyle(this.shapeStyle),this.freeDraw.ctx.fill(n),this.freeDraw.ctx.stroke(n),n},r.prototype.generateHandlePoints=function(){var t=[];t[0]={path:null,point:this.startPoint},t[1]={path:null,point:[this.startPoint[0]+this.width,this.startPoint[1]]},t[2]={path:null,point:[this.startPoint[0]+this.width,this.startPoint[1]+this.height]},t[3]={path:null,point:[this.startPoint[0],this.startPoint[1]+this.height]},this.handlePoints=t},r.prototype.drawRectHandlePoints=function(){for(var t=[],e=0,i=this.handlePoints;e<i.length;e++){var o=i[e];t.push({path:this.drawRectDragPoint(o.point[0],o.point[0],this.handlePointStyle),point:o.point})}},r.prototype.getRectAttributes=function(){var t=this.freeDraw.getCoordinateWithZoomAndOffset(this.startPoint),e=this.freeDraw.addZoomForLength(this.width);return{startPoint:t,height:this.freeDraw.addZoomForLength(this.height),width:e}},r);function r(t){var e=i.call(this,t)||this;return e.width=0,e.height=0,t.startPoint&&0<t.startPoint.length&&t.width&&t.height?(e.startPoint=t.startPoint,e.width=t.width,e.height=t.height,e.draw()):e.init=!0,e}e.default=n});
!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","../config"],e)}(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("../config"),o=(n.prototype.eventTrigger=function(){},n.prototype.drawRectDragPoint=function(e,t,i){var o=new Path2D;o.rect(e-i.size/2,t-i.size/2,i.size,i.size),this.freeDraw.updateCtxStyle(i),this.freeDraw.ctx.fill(o),this.freeDraw.ctx.stroke(o)},n);function n(e){this.edit=!1,this.init=!1,this.id=e.id,this.type=e.type,this.freeDraw=e.freeDraw,e.shapeStyle?this.shapeStyle=e.shapeStyle:this.shapeStyle=i.DefaultShapeStyle,e.handlePointStyle?this.handlePointStyle=e.handlePointStyle:this.handlePointStyle=i.DefaultHandlePointStyle}t.default=o});